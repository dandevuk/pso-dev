<?php$wardField = $extField = $professionField = $drugField = $strengthField = $formField = $quantityField = $quantityTypeField = $otherInfoField =  '';$errors = array('ward'=>'','ext'=>'','profession'=>'','drug'=>'','strength'=>'','form'=>'','quantity'=>'','quantity-type'=>'');$errorCDDrug = '';//$invalidCDDrugsArray = array('alfentanil','buprenorphine','cocaine','dexamfetamine','diamorphine','fentanyl','gabapentin','ketamine','lisdexamfetamine','methadone','methylphenidate','midazolam','morphine','mst','oxycodone','pethidine','phenobarbital','potassium','pregabalin','sativex','tapentadol','targinact','temazepam','tramadol','zomorph');//$invalidCDDrug = implode("|",$invalidCDDrugsArray);if(isset($_POST['submit'])) {if (isset($_POST['first-name'])) {	$firstNameField = htmlspecialchars($_POST['first-name']);}if (isset($_POST['last-name'])) {	$lastNameField = htmlspecialchars($_POST['last-name']);}// Ward empty checkif (empty($_POST['ward'])) {	$errors['ward'] = '<i class="fas fa-exclamation-circle"></i> A ward is required';} else {	$wardField = ($_POST['ward']);}// Extension empty checkif (empty($_POST['ext'])) {	$errors['ext'] = '<i class="fas fa-exclamation-circle"></i> A contact extension is required';} else {	$extField = htmlspecialchars($_POST['ext']);}// Profession empty checkif (empty($_POST['profession'])) {	$errors['profession'] = '<i class="fas fa-exclamation-circle"></i> A position is required';} else {	$professionField = htmlspecialchars($_POST['profession']);}// Drug empty checkif (empty($_POST['drug'])) {	$errors['drug'] = '<i class="fas fa-exclamation-circle"></i> A drug name is required';}else {	//foreach($invalidCDDrugs as $invalidCDDrug){	    //if(strtolower($invalidCDDrug) == trim(strtolower($_POST['drug']))){	    //    $errorCDDrug = 'This is a controlled drug, please use the <a href="cd-order.php">CD order form</a>';	   // } else {		//	$drugField = htmlspecialchars($_POST['drug']);		//}	    //if(strpos(($_POST['drug']), $invalidCDDrug) !== false) {	    //    $errorCDDrug = 'This is a controlled drug, please use the <a href="cd-order.php">CD order form</a>';	    //} else {		//	$drugField = htmlspecialchars($_POST['drug']);		//}				if (preg_match('%\b(alfentanil|buprenorphine|cocaine|dexamfetamine|diamorphine|fentanyl|gabapentin|ketamine|lisdexamfetamine|methadone|methylphenidate|midazolam|morphine|mst|oxycodone|pethidine|phenobarbital|potassium|pregabalin|sativex|tapentadol|targinact|temazepam|tramadol|zomorph)\b%i', $_POST['drug']) > 0) {			$errorCDDrug = '<i class="fas fa-exclamation-circle"></i> This is a controlled drug, please use the <a href="cd-order.php">CD order form</a>';		} else {			$drugField = htmlspecialchars($_POST['drug']);		}	//}}// Drug strength empty checkif ($_POST['strength'] === null) {	$errors['strength'] = '<i class="fas fa-exclamation-circle"></i> A drug strength is required';} else {	$strengthField = htmlspecialchars($_POST['strength']);}// Drug form empty checkif (empty($_POST['form'])) {	$errors['form'] = '<i class="fas fa-exclamation-circle"></i> A drug form is required';} else {	$formField = htmlspecialchars($_POST['form']);}// Quantity empty checkif (empty($_POST['quantity'])) {	$errors['quantity'] = '<i class="fas fa-exclamation-circle"></i> A drug quantity is required';} else {	$quantityField = htmlspecialchars($_POST['quantity']);}// Quantity type empty checkif (empty($_POST['quantity-type'])) {	$errors['quantity-type'] = '<i class="fas fa-exclamation-circle"></i> A drug quantity type is required';} else {	$quantityTypeField = ($_POST['quantity-type']);}$otherInfoField = htmlspecialchars($_POST['other-info']); // end of post checkif(array_filter($errors)) {	echo '<div class="failure-container">';	echo 'Order not placed, please rectify errors below. ';	echo '</div>';} else if($errorCDDrug) {	echo '<div class="failure-container">';	echo 'Order not placed because you have entered a controlled drug. Please use the <a href="cd-order.php">CD order form</a>. ';	echo '</div>';} else {	// Insert form data into database	$sql = "INSERT INTO `stockOrderTable` (`firstName`, `lastName`, `ext`, `profession`, `ward`, `drugName`, `drugStrength`, `drugForm`, `quantity`, `quantityUnit`) VALUES ('$firstNameField', '$lastNameField', '$extField', '$professionField', '$wardField', '$drugField', '$strengthField', '$formField', '$quantityField', '$quantityTypeField')";	if(mysqli_query($conn, $sql)){		//echo 'Added to database';	} else {	// error		echo 'Order sent but not added to order list: ' . mysqli_error($conn);	};	echo '<div class="success-container" id="succ-modal">';		include 'inc/success-close.inc.php';	echo 'Thank you ';	echo htmlspecialchars($firstNameField);		echo '.';		echo '<br />';		echo '<br />';	echo 'Your order for ' ;	echo '<b>' ;	echo htmlspecialchars($quantityField), ' ';	echo htmlspecialchars($quantityTypeField), ' ';	echo '</b>' ;	echo ' of ' ;	echo '<b>' ;	echo htmlspecialchars($drugField), ' ';	echo htmlspecialchars($strengthField), ' ';	echo htmlspecialchars($formField);	echo '</b>' ;	echo ' for ' ;	echo '<b>' ;	echo htmlspecialchars($wardField);	echo '</b>' ;	echo ' has been placed.' ;	echo '</div>';	$to = "dan@holtwebdesign.co.uk";	$subject = "$wardField stock order";	$headers = "From: $firstNameField $lastNameField - $wardField ward"; 	//constructing the message	$body = "From: $firstNameField $lastNameField\n\nWard: $wardField\n\nExtension number: $extField\n\nJob Role: $professionField\n\nDrug: $drugField $strengthField $formField\n\nQuantity: $quantityField $quantityTypeField\n\nOther information: $otherInfoField"; 	// ...and away we go!	mail($to, $subject, $body, $headers);}} else {	echo 'Not sumbitted';}?><div class="form-wrapper" id="additional-stock"><h2>Ward stock order form</h2>		<form action="" method="post" class="order-form" id="order-form">			<div class="form-container">				<div class="form-left">					First name<br /><input class="input-full" type="text" name="first-name" value="<?php echo $_SESSION['first-name']; ?>" readonly="readonly"><br/>					Last name<br /><input class="input-full" type="text" name="last-name" value="<?php echo $_SESSION['surname']; ?>" readonly="readonly"><br/>					<div class="ext-ward-container">						<div>							Extension<br /><input type="text" name="ext" id="contact-input" value="<?php echo htmlspecialchars($extField); ?>"><br />							<div class="error-text"><?php echo $errors['ext']; ?></div>						</div>						<div>							<!-- Fetch wards from database -->							<?php include 'config/fetch-ward-list.php' ?>							Ward<br />							<select name="ward" value="<?php echo htmlspecialchars($wardField); ?>">								<option disabled selected value> -- Select an option -- </option>								<?php foreach ($wards as $ward) { ?>									<option <?php if (isset($wardField) && $wardField==$ward['wardList']) echo "selected";?>><?php echo htmlspecialchars($ward['wardList']); ?></option>								<?php }; ?>							</select>							<br />							<div class="error-text"><?php echo $errors['ward']; ?></div>						</div>					</div>										Position<br /><input class="input-full" type="text" name="profession" value="<?php echo $_SESSION['title']; ?>"><br/>					<div class="error-text"><?php echo $errors['profession']; ?></div>					Other information (optional)<br />					<textarea rows="6" name="other-info"><?php echo htmlspecialchars($otherInfoField); ?></textarea>									</div>				<div class="form-right">					Drug name<br /><input class="input-full" name="drug"><br />					<div class="error-text"><?php echo $errors['drug']; ?></div>					<div class="error-text"><?php echo $errorCDDrug; ?></div>					Strength (Enter 0 if there is no strength ie: Laxido)<br /><input class="input-full" type="text" name="strength" placeholder="Please include unit mg, mcg, etc.." required><br />					<div class="error-text"><?php echo $errors['strength']; ?></div>					Form<br /><input class="input-full" type="text" name="form" placeholder="Tablet, capsule, injection etc.." value="<?php echo htmlspecialchars($formField); ?>"><br />					<div class="error-text"><?php echo $errors['form']; ?></div>					Quantity<br /><input type="number" name="quantity">					<div class="error-text"><?php echo $errors['quantity']; ?></div>					Quantity unit<br />					<select name="quantity-type">						<option disabled selected value> --Select an option -- </option>	  					<option <?php if (isset($quantityTypeField) && $quantityTypeField=="OP") echo "selected";?>>OP</option>	  					<option <?php if (isset($quantityTypeField) && $quantityTypeField=="Box(es)") echo "selected";?>>Box(es)</option>					</select>					<div class="error-text"><?php echo $errors['quantity-type']; ?></div>				</div>			</div>			<div class="form-button-container">				<div class="form-ward-orders">					Has this item already been ordered? Check the latest stock orders.					<a href="order-list.php">Ward Orders</a>				</div>				<button class="order-btn" type="submit" name="submit-button" id="order-btn">PLACE ORDER</button>			</div>		</form></div>