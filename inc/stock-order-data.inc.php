<?php	$sql = "SELECT * FROM stockOrders WHERE orderedOn >=dateadd(day,datediff(day,0,GetDate())-7,0)";	$params = array();	$options =  array( "Scrollable" => SQLSRV_CURSOR_KEYSET );	$stmt = sqlsrv_query( $conn, $sql , $params, $options );	$row_count = sqlsrv_num_rows( $stmt );		if( $stmt  === false ) {		die( print_r( sqlsrv_errors(), true));	}	$sqlF = "SELECT * FROM stockOrders WHERE orderedOn >=dateadd(day,datediff(day,0,GetDate())-14,0)";	$paramsF = array();	$optionsF =  array( "Scrollable" => SQLSRV_CURSOR_KEYSET );	$stmtF = sqlsrv_query( $conn, $sqlF , $paramsF, $optionsF );	$row_countF = sqlsrv_num_rows( $stmtF );		if( $stmtF  === false ) {		die( print_r( sqlsrv_errors(), true));	}	$sqlT = "SELECT * FROM stockOrders WHERE orderedOn >=dateadd(day,datediff(day,0,GetDate())-14,0)";	$paramsT = array();	$optionsT =  array( "Scrollable" => SQLSRV_CURSOR_KEYSET );	$stmtT = sqlsrv_query( $conn, $sqlT , $paramsT, $optionsT );	$row_countT = sqlsrv_num_rows( $stmtT );		if( $stmtT  === false ) {		die( print_r( sqlsrv_errors(), true));	}		$sqlMostOrders = "SELECT TOP 5 ward FROM stockOrders WHERE orderedOn >=dateadd(day,datediff(day,0,GetDate())- 7,0) GROUP BY ward ORDER BY COUNT(ward) DESC";	// Add from last 7 days	$stmtMostOrders = sqlsrv_query($conn, $sqlMostOrders);		if( $stmtMostOrders === false ) {		die( print_r( sqlsrv_errors(), true));	}		$sqlOrdersCount = "SELECT TOP 5 COUNT(ward) FROM stockOrders WHERE orderedOn >=dateadd(day,datediff(day,0,GetDate())- 7,0) GROUP BY ward ORDER BY COUNT(ward) DESC";	// Add from last 7 days	$stmtOrdersCount = sqlsrv_query($conn, $sqlOrdersCount);		if( $stmtOrdersCount === false ) {		die( print_r( sqlsrv_errors(), true));	}		$sqlMostOrdersF = "SELECT TOP 5 ward FROM stockOrders WHERE orderedOn >=dateadd(day,datediff(day,0,GetDate())- 14,0) GROUP BY ward ORDER BY COUNT(ward) DESC";	// Add from last 14 days	$stmtMostOrdersF = sqlsrv_query($conn, $sqlMostOrdersF);		if( $stmtMostOrdersF === false ) {		die( print_r( sqlsrv_errors(), true));	}		$sqlOrdersCountF = "SELECT TOP 5 COUNT(ward) FROM stockOrders WHERE orderedOn >=dateadd(day,datediff(day,0,GetDate())- 14,0) GROUP BY ward ORDER BY COUNT(ward) DESC";	// Add from last 14 days	$stmtOrdersCountF = sqlsrv_query($conn, $sqlOrdersCountF);		if( $stmtOrdersCountF === false ) {		die( print_r( sqlsrv_errors(), true));	}		$sqlMostOrdersT = "SELECT TOP 5 ward FROM stockOrders WHERE orderedOn >=dateadd(day,datediff(day,0,GetDate())- 30,0) GROUP BY ward ORDER BY COUNT(ward) DESC";	// Add from last 30 days	$stmtMostOrdersT = sqlsrv_query($conn, $sqlMostOrdersT);		if( $stmtMostOrdersT === false ) {		die( print_r( sqlsrv_errors(), true));	}		$sqlOrdersCountT = "SELECT TOP 5 COUNT(ward) FROM stockOrders WHERE orderedOn >=dateadd(day,datediff(day,0,GetDate())- 30,0) GROUP BY ward ORDER BY COUNT(ward) DESC";	// Add from last 30 days	$stmtOrdersCountT = sqlsrv_query($conn, $sqlOrdersCountT);		if( $stmtOrdersCountT === false ) {		die( print_r( sqlsrv_errors(), true));	}		if (isset($_POST['ward-row-submit'])) {		$wardOrdersSeven = $_POST['ward-row'];				$sqlWardOrdersSeven = "SELECT * FROM stockOrders WHERE ward='$wardOrdersSeven' AND orderedOn >=dateadd(day,datediff(day,0,GetDate())- 48,0) ";		$stmtWardOrdersSeven = sqlsrv_query($conn, $sqlWardOrdersSeven);	}	?><?php if ($_SESSION['user-role'] == 'Admin' || $_SESSION['user-role'] == 'Pharmacy manager' || $_SESSION['user-role'] == 'Stores manager') { ?><div class="admin-section-wrapper">	<h1>Stock Order Data</h1>		<h2>Orders received within the last</h2>	<div class="days-select-wrapper">		<div class="days-select-container">			<button class="tablink days-btn days-btn-selected" onclick="openDays(event,'sevendays')">7<br />DAYS</button>		</div>		<div class="days-select-container">			<button class="tablink days-btn" onclick="openDays(event,'forteendays')">14<br />DAYS</button>		</div>		<div class="days-select-container">			<button class="tablink days-btn" onclick="openDays(event,'thirtydays')">30<br />DAYS</button>		</div>			</div>		<div class="ward-order-data-wrapper" id="sevendays">			<div class="ward-order-data-container" style="width: 25%">					<h2>Stock Orders Received</h2>						<div class="order-received">							<?php echo $row_count ?>						</div>					</div>			<div class="ward-order-data-container" style="width: 55%" id="7days">					<h2>Most extra stock ordered over the last 7 days</h2>							<?php while( $row = sqlsrv_fetch_array($stmtMostOrders)) { ?>								<div class="top-five-wrapper">											<div class="top-five-container" style="width: 75%; text-align:left;border-radius: 5px 0 0 5px">														<?php echo $row['0'] ?>												</div>										<div class="top-five-container" style="width: 25%; text-align:left" id="table">												<form method="POST" action="#table">																<input type="hidden" name="ward-row" value="<?php echo $row[0] ?>">								<button type="submit" name="ward-row-submit">View orders</button>															</form>											</div>									</div>									<?php } ?>					    </div>							<div class="ward-order-data-container" style="width: 18%;">							<h2>Number of orders</h2>							<?php while( $row = sqlsrv_fetch_array($stmtOrdersCount)) { ?>									<div class="top-five-wrapper">												<div class="top-five-container" style="width: 100%; text-align:center;padding:10px 0!important;border-radius: 0 5px 5px 0">															<?php echo $row['0'] ?>													</div>									</div>										<?php } ?>							</div>				</div>			<!-- 14 days -->		<div class="ward-order-data-wrapper" style="display:none;" id="forteendays">			<div class="ward-order-data-container" style="width: 25%">					<h2>Stock Orders Received</h2>						<div class="order-received">							<?php echo $row_countF ?>						</div>					</div>			<div class="ward-order-data-container" style="width: 55%" id="14days">					<h2>Most extra stock ordered over the last 14 days</h2>							<?php while( $row = sqlsrv_fetch_array($stmtMostOrdersF)) { ?>								<div class="top-five-wrapper">											<div class="top-five-container" style="width: 75%; text-align:left;border-radius: 5px 0 0 5px">														<?php echo $row['0'] ?>												</div>										<div class="top-five-container" style="width: 25%; text-align:left" id="table">												<form method="POST" action="#table">																<input type="hidden" name="ward-row" value="<?php echo $row[0] ?>">								<button type="submit" name="ward-row-submit">View orders</button>															</form>											</div>									</div>									<?php } ?>					    </div>							<div class="ward-order-data-container" style="width: 18%;">							<h2>Number of orders</h2>							<?php while( $row = sqlsrv_fetch_array($stmtOrdersCountF)) { ?>									<div class="top-five-wrapper">												<div class="top-five-container" style="width: 100%; text-align:center;padding:10px 0!important;border-radius: 0 5px 5px 0">															<?php echo $row['0'] ?>													</div>									</div>										<?php } ?>							</div>				</div>			<!-- 30 days -->		<div class="ward-order-data-wrapper" style="display:none;" id="thirtydays">			<div class="ward-order-data-container" style="width: 25%">					<h2>Stock Orders Received</h2>						<div class="order-received">							<?php echo $row_countT ?>						</div>					</div>			<div class="ward-order-data-container" style="width: 55%" id="30days">					<h2>Most extra stock ordered over the last 30 days</h2>							<?php while( $row = sqlsrv_fetch_array($stmtMostOrdersT)) { ?>								<div class="top-five-wrapper">											<div class="top-five-container" style="width: 75%; text-align:left;border-radius: 5px 0 0 5px">														<?php echo $row['0'] ?>												</div>										<div class="top-five-container" style="width: 25%; text-align:left" id="table">												<form method="POST" action="#table">																<input type="hidden" name="ward-row" value="<?php echo $row[0] ?>">								<button type="submit" name="ward-row-submit">View orders</button>															</form>											</div>									</div>									<?php } ?>					    </div>							<div class="ward-order-data-container" style="width: 18%;">							<h2>Number of orders</h2>							<?php while( $row = sqlsrv_fetch_array($stmtOrdersCountT)) { ?>									<div class="top-five-wrapper">												<div class="top-five-container" style="width: 100%; text-align:center;padding:10px 0!important;border-radius: 0 5px 5px 0">															<?php echo $row['0'] ?>													</div>									</div>										<?php } ?>							</div>				</div>		</div>	</div></div><?php if (isset($_POST['ward-row'])) { ?>	<div class="admin-section-wrapper" style="margin-top: 40px">		<div class="list-table-wrapper">		<div class="itu-order-wrapper">				<h2><?php echo $wardOrdersSeven ?></h2>			<ul>				<?php     			    				while ($row = sqlsrv_fetch_array($stmtWardOrdersSeven, SQLSRV_FETCH_ASSOC)) { ?>							<li>								<div class="ward-order-container">																	<div>																		<div class="">											<h2>Date</h2>											<?php echo $row['orderedOn']->format('d-M-Y'); ?>										</div>										<div class="">											<h2>Ordered by</h2>											<?php echo $row['name'] ?>										</div>										<div class="">											<h2>Ward</h2>											<?php echo $row['ward'] ?>										</div>																		</div>																		<div class="itu-drug-order">										<table>											<th>Drug</th>											<th>Qty</th>																						<tr>												<td><?php echo $row['drugName'] ?></td>												<td><?php echo $row['quantity'] ?></td>												</tr>											<?php if(!empty($row['drugName2'])) { ?>												<tr>													<td><?php echo $row['drugName2'] ?></td>													<td><?php echo $row['quantity2'] ?></td>												</tr>										    <?php } ?>											<?php if(!empty($row['drugName3'])) { ?>												<tr>													<td><?php echo $row['drugName3'] ?></td>													<td><?php echo $row['quantity3'] ?></td>													</tr>										    <?php } ?>											<?php if(!empty($row['drugName4'])) { ?>												<tr>													<td><?php echo $row['drugName4'] ?></td>													<td><?php echo $row['quantity4'] ?></td>													</tr>										    <?php } ?>											<?php if(!empty($row['drugName5'])) { ?>												<tr>													<td><?php echo $row['drugName5'] ?></td>													<td><?php echo $row['quantity5'] ?></td>														</tr>										    <?php } ?>											<?php if(!empty($row['drugName6'])) { ?>												<tr>													<td><?php echo $row['drugName6'] ?></td>													<td><?php echo $row['quantity6'] ?></td>													</tr>										    <?php } ?>											<?php if(!empty($row['drugName7'])) { ?>												<tr>													<td><?php echo $row['drugName7'] ?></td>													<td><?php echo $row['quantity7'] ?></td>														</tr>										    <?php } ?>											<?php if(!empty($row['drugName8'])) { ?>												<tr>													<td><?php echo $row['drugName8'] ?></td>													<td><?php echo $row['quantity8'] ?></td>												</tr>										    <?php } ?>											<?php if(!empty($row['drugName9'])) { ?>												<tr>													<td><?php echo $row['drugName9'] ?></td>													<td><?php echo $row['quantity9'] ?></td>													</tr>										    <?php } ?>											<?php if(!empty($row['drugName10'])) { ?>												<tr>													<td><?php echo $row['drugName10'] ?></td>													<td><?php echo $row['quantity10'] ?></td>														</tr>										    <?php } ?>										</table>																			</div>								</div>									</li>												<?php } ?>			</ul>		</div>	</div><?php } } else {	echo '<script>window.location.href = "index.php";</script>';} ?>