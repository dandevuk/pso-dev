<?php$wardFieldCD = $extFieldCD = $positionFieldCD = $drugFieldCD = $quantityFieldCD = $otherInfoFieldCD = '';$errorsCD = array('wardCD'=>'','extCD'=>'','positionCD'=>'','drugCD'=>'','quantityCD'=>'');if(isset($_POST['submitCD'])) {if (isset($_POST['first-nameCD'])) {$firstNameFieldCD = $_POST['first-nameCD'];}if (isset($_POST['last-nameCD'])) {$lastNameFieldCD = $_POST['last-nameCD'];}// Ward empty checkif (empty($_POST['wardCD'])) {	$errorsCD['wardCD'] = '<i class="fas fa-exclamation-circle"></i> A ward is required';} else {	$wardFieldCD = ($_POST['wardCD']);}// Extension empty checkif (empty($_POST['extCD'])) {	$errorsCD['extCD'] = '<i class="fas fa-exclamation-circle"></i> A contact extension is required';} else {	$extFieldCD = htmlspecialchars($_POST['extCD']);}// Position empty checkif (empty($_POST['positionCD'])) {		$errorsCD['positionCD'] = '<i class="fas fa-exclamation-circle"></i> A position is required';} else {	$positionFieldCD = htmlspecialchars($_POST['positionCD']);}// Drug empty checkif (empty($_POST['drugCD'])) {	$errorsCD['drugCD'] = '<i class="fas fa-exclamation-circle"></i> A drug name is required';} else {	$drugFieldCD = htmlspecialchars($_POST['drugCD']);}// Quantity empty checkif (empty($_POST['quantityCD'])) {	$errorsCD['quantityCD'] = '<i class="fas fa-exclamation-circle"></i> A drug quantity is required';} else {	$quantityFieldCD = htmlspecialchars($_POST['quantityCD']);} // end of post check$otherInfoFieldCD = htmlspecialchars($_POST['other-infoCD']);if(array_filter($errorsCD)) {		echo '<div class="failure-container">';	echo '<span id="errors-icon-left"><i class="fas fa-exclamation-circle"></i></span>';	echo 'Order not placed, please rectify errors below.';	echo '<span id="errors-icon-right"><i class="fas fa-exclamation-circle"></i></span>';    echo '</div>';} else {	// Insert form data into database		//$date = date('d-m-Y');		$userEmail = $_SESSION['user-email'];	$sql = "INSERT INTO dbo.cdReqNumber (firstName, lastName, position, ext, ward, drugName, quantity, email, info) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)";		$params1 = array($firstNameFieldCD, $lastNameFieldCD, $positionFieldCD, $extFieldCD, $wardFieldCD, $drugFieldCD, $quantityFieldCD, $userEmail, $otherInfoFieldCD);    		$result = sqlsrv_query($conn,$sql,$params1);	//if(sqlsrv_query($conn,$sql,$params1)){	//	echo 'Added to database';	//} else {	// error		//echo 'Order sent but not added to database '.;		if($result === false ) {			if( ($errors = sqlsrv_errors() ) != null) {				foreach( $errors as $error ) {				echo "SQLSTATE: ".$error[ 'SQLSTATE']."<br />";				echo "code: ".$error[ 'code']."<br />";				echo "message: ".$error[ 'message']."<br />";				}			}		};	//};	// Select auto created req numbers from database order by time newest first	$sqlReqNum = "SELECT reqNumberID FROM cdReqNumber ORDER BY orderedOn DESC OFFSET 0 ROWS FETCH FIRST 1 ROWS ONLY";		// Make query and get result	$reqResult = sqlsrv_query($conn, $sqlReqNum);	// Fetch resulting rows an array	//$reqNumbers = sqlsrv_fetch_array($reqResult);		// Grab latest req number - number for this order	//foreach ($reqNumbers as $reqNumber) {	//	$orderReqNumber = $reqNumber['reqNumberID'];	//}		while( $row = sqlsrv_fetch_array($reqResult) ) {		$orderReqNumber = $row['0'];	}	// Free result from memory	sqlsrv_free_stmt($reqResult);		include 'inc/cd-success-close.inc.php';}}?><div class="cd-legal-container">	<span id="warning-icon-left"><i class="fas fa-exclamation-triangle"></i></span>	Controlled drugs must be ordered by an authorised Registered Nurse, Registered Midwife or Operating Department Practitioner (ODP) for wards, theatres and recovery. If you are neither of these please do not use this form.		<span id="warning-icon-right"><i class="fas fa-exclamation-triangle"></i></span></div><div class="form-wrapper" id="cd-stock"><h2>Controlled drug order form</h2>		<form action="cd-order.php" method="post">			<div class="form-container">				<div class="form-left">					First name<br /><input class="input-full" type="text" name="first-nameCD" value="<?php echo $_SESSION['first-name']; ?>" readonly="readonly"><br/>										Last name<br /><input class="input-full read-only" type="text" name="last-nameCD" value="<?php echo $_SESSION['surname']; ?>" readonly="readonly"><br/>										Extension<br /><input type="text" name="extCD" id="contact-input" value="<?php echo htmlspecialchars($extFieldCD); ?>"><br />										<div class="error-text"><?php echo $errorsCD['extCD']; ?></div>										Position<br />					<input type="radio" name="positionCD" value="Registered Nurse">					<label for="Registered Nurse">Registered Nurse</label>					<input type="radio" name="positionCD" value="Registered Midwife">					<label for="Registered Midwife">Registered Midwife</label>					<input type="radio" name="positionCD" value="ODP">					<label for="ODP">ODP</label>					<div class="error-text"><?php echo $errorsCD['positionCD']; ?></div>					<!-- Fetch wards from database -->					<?php include 'config/fetch-ward-list.php' ?>					Ward<br />					<select name="wardCD" value="<?php echo htmlspecialchars($wardFieldCD); ?>">						<option disabled selected value> -- Select an option -- </option>						<?php while( $row = sqlsrv_fetch_array( $stmt) ) { ?>							<option <?php if (isset($wardCD) && $wardCD==$row[0]) {echo "selected";} ?>><?php echo $row[0] ?></option>						<?php }; ?>					</select>										<br />					<div class="error-text"><?php echo $errorsCD['wardCD']; ?></div>									</div>				<!-- Fetch all CD drugs -->				<?php include 'config/fetch-cd-high-strength.php'; ?>								<?php include 'config/fetch-cd-drugs.php'; ?>				<div class="form-right">					Drug name <span class="dosage-btn dosage-btn-selected tablink" onclick="openDosage(event,'normal-cd')">Standard Strength</span> <span class="dosage-btn tablink" onclick="openDosage(event,'high-dosage-cd')">High Strength</span><br />									<div class="dosage-select" id="normal-cd">						<select class="drug-select" name="drugCD" value="<?php echo htmlspecialchars($drugFieldCD); ?>">							<option disabled selected value> -- Select an option -- </option>							<?php while( $row = sqlsrv_fetch_array( $stmt) ) {?>								<option <?php if (isset($drugFieldCD) && $drugFieldCD==$row['0']) echo "selected";?>><?php echo htmlspecialchars($var = $row['0']); ?></option>							<?php } sqlsrv_free_stmt( $stmt); ?>						</select>										</div>									<div class="dosage-select" style="display:none;" id="high-dosage-cd">						<select class="drug-select high-dosage-input" name="drugCD" value="<?php echo htmlspecialchars($drugFieldCD); ?>">							<option disabled selected value> -- Select an option -- </option>							<?php while( $row = sqlsrv_fetch_array( $stmtHigh) ) {?>								<option <?php if (isset($drugFieldCD) && $drugFieldCD==$row['0']) echo "selected";?>><?php echo htmlspecialchars($var = $row['0']); ?></option>							<?php } sqlsrv_free_stmt( $stmtHigh);?>						</select>										</div>					<div class="error-text"><?php echo $errorsCD['drugCD']; ?></div>					<br>					Quantity<br /><input type="text" name="quantityCD" value="<?php echo htmlspecialchars($quantityFieldCD); ?>">					<div class="error-text"><?php echo $errorsCD['quantityCD']; ?></div>					Other information (optional)<br />					<textarea rows="6" name="other-infoCD" maxlength="200"><?php echo htmlspecialchars($otherInfoFieldCD); ?></textarea>				</div>			</div>						<div class="form-button-container">				<div class="form-ward-orders">					Has this item already been ordered? Check the latest stock orders.					<a href="cd-order-list.php">Recent CD Orders</a>				</div>				<button class="order-btn" type="submitCD" name="submitCD" onclick="document.getElementById('loading-wrapper').style.display='flex'">PLACE ORDER</button>			</div>		</form></div>